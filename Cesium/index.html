<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>3D Tiles数据加载</title>
    <link rel="stylesheet" href="http://localhost:8080/libs/Cesium/1.40/Build/Cesium/Widgets/widgets.css">
    <script type="text/javascript" src="http://localhost:8080/plugin/jquery/jquery-3.2.1.min.js"></script>
    <script type="text/javascript" src="http://localhost:8080/libs/Cesium/1.40/Build/Cesium/Cesium.js"></script>
    <style>
        html, body, #cesiumContainer {
            width: 100%;
            height: 100%;
            margin: 0;
            padding: 0;
            overflow: hidden;
        }
    </style>
</head>
<body>
<div id="cesiumContainer"></div>
<script>
    var viewer = new Cesium.Viewer("cesiumContainer", {
        animation: false, //是否创建动画小器件，左下角仪表
        baseLayerPicker: false,//是否显示图层选择器,右上角按钮
        fullscreenButton: false,//是否显示全屏按钮,右下角按钮
        geocoder: false,//是否显示geocoder小器件，右上角查询按钮
        homeButton: false,//是否显示Home按钮,右上角按钮
        infoBox: true,//是否显示信息框
        sceneModePicker: false,//是否显示3D/2D选择器 ,右上角按钮
        selectionIndicator: false,//是否显示选取指示器组件，绿色选中框
        timeline: false,//是否显示时间轴，底部
        navigationHelpButton: false//是否显示帮助按钮，右上角按钮
    });

    // 定义初始视角的位置和方位
    var initialPosition = Cesium.Cartesian3.fromDegrees(108.95403137246454, 34.214154390264106, 1000); // 目标坐标
    var initialOrientation = new Cesium.HeadingPitchRoll.fromDegrees(45, -45, 0); // 方位

    // 设置camera的位置
    viewer.scene.camera.setView({
        destination: initialPosition,
        orientation: initialOrientation,
        endTransform: Cesium.Matrix4.IDENTITY
    });

    // 加载3D Tiles 图层
    var tileSet = new Cesium.Cesium3DTileset({
        url: "http://localhost:8080/3d/dayanta/Tileset.json"
    });

    viewer.scene.primitives.add(tileSet);

    // 当tileSet加载完成后，修改模型的高度，避免飘在空中的现象
    tileSet.readyPromise.then(function (tileset) {
        changeHeight(tileset, 0);
    });


    //方法二，直接调用函数，调整高度,height表示物体离地面的高度
    function changeHeight(tileset, height) {
        height = Number(height);
        if (isNaN(height)) {
            return;
        }
        debugger;
        var cartographic = Cesium.Cartographic.fromCartesian(tileset.boundingSphere.center);
        var surface = Cesium.Cartesian3.fromRadians(cartographic.longitude, cartographic.latitude, cartographic.height);
        var offset = Cesium.Cartesian3.fromRadians(cartographic.longitude, cartographic.latitude, height);
        var translation = Cesium.Cartesian3.subtract(offset, surface, new Cesium.Cartesian3());
        tileset.modelMatrix = Cesium.Matrix4.fromTranslation(translation);
    }

    // //得到当前三维场景
    // var scene = viewer.scene;
    // //得到当前三维场景的椭球体
    // var ellipsoid = scene.globe.ellipsoid;
    //
    // // 注册屏幕空间事件
    // viewer.screenSpaceEventHandler.setInputAction(function (clickEvent) {
    //     //通过指定的椭球或者地图对应的坐标系，将鼠标的二维坐标转换为对应椭球体三维坐标
    //     var cartesian = viewer.camera.pickEllipsoid(clickEvent.position, ellipsoid);
    //     if (cartesian) {
    //         //将笛卡尔坐标转换为地理坐标
    //         var cartographic = ellipsoid.cartesianToCartographic(cartesian);
    //         //将弧度转为度的十进制度表示
    //         var longitudeString = Cesium.Math.toDegrees(cartographic.longitude);
    //         var latitudeString = Cesium.Math.toDegrees(cartographic.latitude);
    //         console.log('(' + longitudeString + ', ' + latitudeString + ')');
    //     }
    // }, Cesium.ScreenSpaceEventType.LEFT_CLICK); // 左击

</script>
</body>
</html>